# Specify which branches to build using a safelist
# 分支白名单限制：只有 master 分支的提交才会触发构建
# branches:
#   only:
#     - master
sudo: required

env:
 global:
   # Github Pages
   - GH_REF: github.com/he-sb/he-sb.github.io

git:
  submodules: false

# Use sed to replace the SSH URL with the public URL, then initialize submodules
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive

install:
  - chmod a+x binary/hugo && binary/hugo
  
script:
  # 部署
  - cd ./public
  - git init
  - git config user.name "he-sb"
  - git config user.email "0he.sb0@gmail.com"
  - git add .
  - git commit -m "Update Blog By TravisCI With Build $TRAVIS_BUILD_NUMBER"
  # Github Pages
  - git push --force --quiet "https://$GITHUB_TOKEN@${GH_REF}" master:master